<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Wƒôdliny z Druciarni ‚Äî Zam√≥wienia</title>
<meta name="theme-color" content="#111827">
<style>
  :root{ --bg:#0b0f1a; --card:#111827; --muted:#9ca3af; --text:#e5e7eb; --accent:#fbbf24; --btn:#1f2937; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
  .app{display:flex;flex-direction:column;min-height:100dvh}
  .topbar{position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:12px;padding:12px 16px;background:rgba(17,24,39,.9);backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid #1f2937}
  .logo{height:56px;width:auto;border-radius:12px;background:#0b0f1a;padding:6px}
  .title{display:flex;flex-direction:column;line-height:1.1}
  .title h1{margin:0;font-size:18px}
  .title .tag{font-size:12px;color:var(--muted)}
  .content{flex:1;padding:16px;display:grid;gap:14px}
  .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:14px;box-shadow:0 2px 10px rgba(0,0,0,.2)}
  h3{margin:0 0 8px 0;font-size:16px}
  input,select,textarea,button{font:inherit}
  input,select,textarea{width:100%;padding:14px;border-radius:12px;border:1px solid #293445;background:#0b1220;color:var(--text)}
  textarea{min-height:96px}
  .grid-2{display:grid;gap:10px;grid-template-columns:1fr}
  @media (min-width:760px){.grid-2{grid-template-columns:1fr 1fr}}
  .row{display:grid;gap:10px;grid-template-columns:1fr}
  @media (min-width:520px){.row{grid-template-columns:5fr 5fr 3fr;align-items:center}}
  .qty{display:grid;grid-template-columns:auto 1fr auto;gap:8px}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:14px 16px;border-radius:14px;border:1px solid #2a3648;background:var(--btn);color:var(--text);text-decoration:none;cursor:pointer;min-height:48px}
  .btn.primary{background:linear-gradient(180deg,#f59e0b,#f59e0b 60%,#d97706);color:#111;border-color:#f59e0b}
  .btn.ghost{background:transparent}
  .btn.small{padding:8px 10px;min-height:36px;font-size:12px;border-radius:10px}
  .actions-bottom{position:sticky;bottom:0;z-index:10;background:rgba(17,24,39,.96);backdrop-filter:blur(8px);border-top:1px solid #1f2937;padding:10px 12px}
  .actions-grid{display:grid;gap:8px;grid-template-columns:1fr 1fr}
  @media (min-width:560px){.actions-grid{grid-template-columns:repeat(6,1fr)}}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#0b1220;border:1px solid #2a3648;color:var(--muted);font-size:12px}
  .muted{color:var(--muted);font-size:12px}
  .summary{background:#0b1220;border:1px solid #2a3648;border-radius:12px;padding:12px;white-space:pre-wrap}
  .search input{padding-left:44px}
  .search{position:relative}
  .search .icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);opacity:.6}
  .product{display:grid;gap:10px}
  .product .name{display:flex;align-items:center;gap:10px;justify-content:space-between}
  .product .name strong{font-size:14px}
  .price{font-size:14px;font-weight:700;color:#e5e7eb}
  .pack{display:grid;grid-template-columns:auto 1fr;align-items:center;gap:10px;font-size:12px;color:#cfe5d9}
  .pack .label{display:inline-block;padding:10px 12px;border-radius:12px;background:#0b1220;border:1px solid #2a3648;font-size:14px;font-weight:800;letter-spacing:.2px;opacity:1}
  .pack select{width:auto;min-width:100px}

  /* Badge DO WYCENY */
  .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:2px solid #fbbf24;background:#1a1f2e;color:#fbbf24;font-size:13px;font-weight:800;letter-spacing:.3px}
  .badge .dot{width:8px;height:8px;border-radius:50%;background:#fbbf24;opacity:.9}

  /* Modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);display:none;align-items:center;justify-content:center;z-index:50}
  .modal{width:min(560px,92vw);background:var(--card);border:1px solid #1f2937;border-radius:16px;box-shadow:0 15px 40px rgba(0,0,0,.45);padding:16px}
  .modal h4{margin:0 0 10px 0;font-size:16px}
  .modal .grid{display:grid;gap:10px;grid-template-columns:1fr}
  @media (min-width:640px){.modal .grid{grid-template-columns:1fr 1fr}}
  .modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
  .field-note{font-size:12px;color:var(--muted);margin-top:2px}
  .error{border-color:#dc2626!important;outline-color:#dc2626!important}

  /* Custom section at the bottom */
  #custom-section {margin-top:16px; padding:12px; text-align:center;}
  #btn-add-custom-bottom {font-size:16px; padding:16px 20px; border-radius:16px; background:#f59e0b; color:#111; font-weight:800;}

</style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <img src="logo.png" class="logo" alt="Logo" />
    <div class="title">
      <h1>Wƒôdliny z Druciarni</h1>
      <div class="tag">Formularz zam√≥wie≈Ñ</div>
    </div>
  </div>

  <div class="content">
    <div class="card">
      <h3>Klient</h3>
      <div class="grid-2">
        <input id="cust-name" placeholder="Imiƒô i nazwisko" />
        <input id="cust-phone" placeholder="Telefon" inputmode="tel" />
        <input id="cust-email" placeholder="E-mail (opcjonalnie)" inputmode="email" />
        <input id="cust-date" type="date" placeholder="Data odbioru" />
        <textarea id="cust-notes" placeholder="Uwagi do zam√≥wienia (np. grubo≈õƒá, przyprawy)"></textarea>
      </div>
      <div class="muted" style="margin-top:6px;">
        Pakowanie pr√≥≈ºniowe mo≈ºliwe za dop≈ÇatƒÖ: <strong>1,50 z≈Ç</strong> za ka≈ºdƒÖ pozycjƒô z zaznaczeniem opcji.
        <div class="pack-controls" style="margin-top:6px;display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn small" id="btn-pack-all">Zaznacz pakowanie dla wszystkich z ilo≈õciƒÖ</button>
          <button class="btn small ghost" id="btn-pack-clear">Odznacz pakowanie wszƒôdzie</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
        <h3>Produkty</h3>
        <div class="search" style="min-width:220px;"></div>
        <div class="search" style="min-width:220px;">
          <span class="icon">üîé</span>
          <input id="search" placeholder="Szukaj produktu‚Ä¶" />
        </div>
      </div>
      <div class="muted" style="margin-top:6px;">
        Mini cennik: Szynka/Karczek/Schab/Boczek <b>47 z≈Ç/kg</b> ¬∑
        Kie≈Çbasa bia≈Ça <b>35 z≈Ç/kg</b> ¬∑ Kie≈Çbasa wƒôdzona <b>37 z≈Ç/kg</b> ¬∑
        Polƒôdwiczka <b>25 z≈Ç/szt</b> ¬∑ Pasztet <b>20 z≈Ç/szt</b> ¬∑ Salceson <b>35 z≈Ç/kg</b> ¬∑
        Serki (bez przypraw / czarnuszka / pomidory-bazylia / czosnek / curry / chilli) <b>10 z≈Ç/szt</b> ¬∑
        Makrela <b>22 z≈Ç/szt</b> ¬∑ ≈öled≈∫ <b>20 z≈Ç/szt</b> ¬∑ ≈Åoso≈õ <b>55 z≈Ç/kg</b> ¬∑ Krupniok <b>18 z≈Ç/kg</b>.
      </div>
      <div id="product-list" class="grid" style="gap:10px; margin-top:8px;"></div>
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-top:10px;">
        <span class="pill">Razem ilo≈õƒá: <b id="total-qty">0</b></span>
        <span class="pill">Razem kwota: <b id="total-sum">0,00 z≈Ç</b></span>
      </div>

      <!-- Przycisk dodaj w≈ÇasnƒÖ pozycjƒô przeniesiony na d√≥≈Ç -->
      <div id="custom-section">
        <button id="btn-add-custom-bottom">‚ûï Dodaj w≈ÇasnƒÖ pozycjƒô (do wyceny)</button>
      </div>
    </div>

    <div class="card">
      <h3>Wysy≈Çka</h3>
      <div class="grid-2">
        <input id="dest-phone" value="48791412017" placeholder="Numer do WhatsApp/SMS (np. 48600111222)" inputmode="tel" />
        <div></div>
      </div>
      <div class="muted" style="margin-top:6px;">Numer w formacie miƒôdzynarodowym, bez spacji.</div>
    </div>

    <div class="card">
      <h3>Podsumowanie</h3>
      <div class="summary" id="summary"></div>
    </div>
  </div>

  <!-- Modal: Dodaj w≈ÇasnƒÖ pozycjƒô (do wyceny) -->
  <div class="modal-backdrop" id="modal-custom">
    <div class="modal">
      <h4>Dodaj w≈ÇasnƒÖ pozycjƒô (do wyceny)</h4>
      <div class="grid">
        <div style="grid-column:1/-1">
          <label for="custom-name" class="field-note">Nazwa (wymagane, 3‚Äì60 znak√≥w)</label>
          <input id="custom-name" maxlength="60" placeholder="np. Szynka specjalna" />
        </div>
        <div>
          <label for="custom-qty" class="field-note">Ilo≈õƒá (wymagane, &gt; 0)</label>
          <input id="custom-qty" type="number" inputmode="decimal" placeholder="np. 1" />
        </div>
        <div>
          <label for="custom-unit" class="field-note">Jednostka</label>
          <select id="custom-unit">
            <option value="kg">kg</option>
            <option value="szt">szt</option>
          </select>
        </div>
        <div style="grid-column:1/-1">
          <label for="custom-notes" class="field-note">Uwagi (opcjonalnie)</label>
          <input id="custom-notes" placeholder="np. grubo mielone, lekko pikantne" />
        </div>
      </div>
      <div class="actions">
        <button class="btn ghost" id="custom-cancel">Anuluj</button>
        <button class="btn primary" id="custom-save">Dodaj pozycjƒô</button>
      </div>
    </div>
  </div>

  <div class="actions-bottom">
    <div class="actions-grid">
      <button class="btn" id="btn-copy">Kopiuj</button>
      <button class="btn" id="btn-csv">CSV</button>
      <a class="btn" id="btn-email" href="#">E-mail</a>
      <a class="btn primary" id="btn-wa" href="#" target="_blank">WhatsApp</a>
      <a class="btn" id="btn-sms" href="#">SMS</a>
      <button class="btn ghost" id="btn-clear">Wyczy≈õƒá</button>
    </div>
  </div>
</div>

<script>
// Podpinamy nowy przycisk do istniejƒÖcej logiki modala
function openCustomModal(){ modal.open(); }

const modal = {
  el: document.getElementById('modal-custom'),
  name: null, qty: null, unit: null, notes: null,
  open(){
    this.name = document.getElementById('custom-name');
    this.qty = document.getElementById('custom-qty');
    this.unit = document.getElementById('custom-unit');
    this.notes = document.getElementById('custom-notes');
    this.name.value = '';
    this.qty.value = '';
    this.unit.value = 'kg';
    this.notes.value = '';
    this.clearErrors();
    this.el.style.display = 'flex';
    setTimeout(()=> this.name.focus(), 0);
  },
  close(){ this.el.style.display = 'none'; },
  clearErrors(){
    [this.name,this.qty].forEach(i=> i && i.classList.remove('error'));
  },
  validate(){
    this.clearErrors();
    const n = (this.name.value||'').trim();
    const q = parseFloat(this.qty.value.replace(',', '.'));
    let ok = true;
    if (n.length < 3 || n.length > 60){ this.name.classList.add('error'); ok = false; }
    if (!(q > 0)){ this.qty.classList.add('error'); ok = false; }
    return ok ? { name:n, qty:q, unit:this.unit.value, notes:(this.notes.value||'').trim() } : null;
  }
};

function closeCustomModal(){ modal.close(); }

document.getElementById('custom-cancel').addEventListener('click', closeCustomModal);
document.getElementById('modal-custom').addEventListener('click', (e)=>{
  if (e.target === document.getElementById('modal-custom')) closeCustomModal();
});
document.getElementById('custom-save').addEventListener('click', ()=>{
  const data = modal.validate();
  if (!data) return;
  const id = 'custom-' + Date.now().toString(36);
  state.rows.push({ id, name: data.name, qty: data.qty, unit: data.unit, pack:false, notes:data.notes });
  saveAndRender();
  closeCustomModal();
});

// Nowy przycisk na dole
const btnBottom = document.getElementById('btn-add-custom-bottom');
btnBottom.addEventListener('click', openCustomModal);
</script>
</body>
</html>