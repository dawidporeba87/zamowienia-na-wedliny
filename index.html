<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Wƒôdliny z Druciarni ‚Äî Zam√≥wienia</title>
<meta name="theme-color" content="#111827">
<style>
  :root{ --bg:#0b0f1a; --card:#111827; --muted:#9ca3af; --text:#e5e7eb; --accent:#fbbf24; --btn:#1f2937; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
  .app{display:flex;flex-direction:column;min-height:100dvh}
  .topbar{position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:12px;padding:12px 16px;background:rgba(17,24,39,.9);backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid #1f2937}
  .logo{height:56px;width:auto;border-radius:12px;background:#0b0f1a;padding:6px}
  .title{display:flex;flex-direction:column;line-height:1.1}
  .title h1{margin:0;font-size:18px}
  .title .tag{font-size:12px;color:var(--muted)}
  .content{flex:1;padding:16px;display:grid;gap:14px}
  .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:14px;box-shadow:0 2px 10px rgba(0,0,0,.2)}
  h3{margin:0 0 8px 0;font-size:16px}
  input,select,textarea,button{font:inherit}
  input,select,textarea{width:100%;padding:14px;border-radius:12px;border:1px solid #293445;background:#0b1220;color:var(--text)}
  textarea{min-height:96px}
  .grid-2{display:grid;gap:10px;grid-template-columns:1fr}
  @media (min-width:760px){.grid-2{grid-template-columns:1fr 1fr}}
  .row{display:grid;gap:10px;grid-template-columns:1fr}
  @media (min-width:560px){.row{grid-template-columns:4fr 2fr 2fr 2fr;align-items:center}}
  .qty{display:grid;grid-template-columns:auto 1fr auto;gap:8px}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:14px 16px;border-radius:14px;border:1px solid #2a3648;background:var(--btn);color:var(--text);text-decoration:none;cursor:pointer;min-height:48px}
  .btn.primary{background:linear-gradient(180deg,#f59e0b,#f59e0b 60%,#d97706);color:#111;border-color:#f59e0b}
  .btn.ghost{background:transparent}
  .btn.small{padding:8px 10px;min-height:36px;font-size:12px;border-radius:10px}
  .actions-bottom{position:sticky;bottom:0;z-index:10;background:rgba(17,24,39,.96);backdrop-filter:blur(8px);border-top:1px solid #1f2937;padding:10px 12px}
  .actions-grid{display:grid;gap:8px;grid-template-columns:1fr 1fr}
  @media (min-width:560px){.actions-grid{grid-template-columns:repeat(6,1fr)}}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#0b1220;border:1px solid #2a3648;color:var(--muted);font-size:12px}
  .muted{color:var(--muted);font-size:12px}
  .summary{background:#0b1220;border:1px solid #2a3648;border-radius:12px;padding:12px;white-space:pre-wrap}
  .search input{padding-left:44px}
  .search{position:relative}
  .search .icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);opacity:.6}
  .product{display:grid;gap:10px}
  .product .name{display:flex;align-items:center;gap:10px;justify-content:space-between}
  .product .name strong{font-size:14px}
  .price{font-size:14px;font-weight:700;color:#e5e7eb}
  .pack{display:grid;grid-template-columns:auto 1fr;align-items:center;gap:10px;font-size:12px;color:#cfe5d9}
  .pack .label{display:inline-block;padding:10px 12px;border-radius:12px;background:#0b1220;border:1px solid #2a3648;font-size:14px;font-weight:800;letter-spacing:.2px;opacity:1}
  .pack select{width:auto;min-width:100px}

  /* Badge DO WYCENY */
  .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:2px solid #fbbf24;background:#1a1f2e;color:#fbbf24;font-size:13px;font-weight:800;letter-spacing:.3px}
  .badge .dot{width:8px;height:8px;border-radius:50%;background:#fbbf24;opacity:.9}

  /* Modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);display:none;align-items:center;justify-content:center;z-index:50}
  .modal{width:min(560px,92vw);background:var(--card);border:1px solid #1f2937;border-radius:16px;box-shadow:0 15px 40px rgba(0,0,0,.45);padding:16px}
  .modal h4{margin:0 0 10px 0;font-size:16px}
  .modal .grid{display:grid;gap:10px;grid-template-columns:1fr}
  @media (min-width:640px){.modal .grid{grid-template-columns:1fr 1fr}}
  .modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
  .field-note{font-size:12px;color:var(--muted);margin-top:2px}
  .error{border-color:#dc2626!important;outline-color:#dc2626!important}

  /* Custom section at the bottom */
  #custom-section {margin-top:16px; padding:12px; text-align:center;}
  #btn-add-custom-bottom {font-size:16px; padding:16px 20px; border-radius:16px; background:#f59e0b; color:#111; font-weight:800;}
</style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <img src="logo.png" class="logo" alt="Logo" />
    <div class="title">
      <h1>Wƒôdliny z Druciarni</h1>
      <div class="tag">Formularz zam√≥wie≈Ñ</div>
    </div>
  </div>

  <div class="content">
    <div class="card">
      <h3>Klient</h3>
      <div class="grid-2">
        <input id="cust-name" placeholder="Imiƒô i nazwisko" />
        <input id="cust-phone" placeholder="Telefon" inputmode="tel" />
        <input id="cust-email" placeholder="E-mail (opcjonalnie)" inputmode="email" />
        <input id="cust-date" type="date" placeholder="Data odbioru" />
        <textarea id="cust-notes" placeholder="Uwagi do zam√≥wienia (np. grubo≈õƒá, przyprawy)"></textarea>
      </div>
      <div class="muted" style="margin-top:6px;">
        Pakowanie pr√≥≈ºniowe mo≈ºliwe za dop≈ÇatƒÖ: <strong>1,50 z≈Ç</strong> za ka≈ºdƒÖ pozycjƒô z zaznaczeniem opcji.
        <div class="pack-controls" style="margin-top:6px;display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn small" id="btn-pack-all">Zaznacz pakowanie dla wszystkich z ilo≈õciƒÖ</button>
          <button class="btn small ghost" id="btn-pack-clear">Odznacz pakowanie wszƒôdzie</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
        <h3>Produkty</h3>
        <div class="search" style="min-width:220px;"></div>
        <div class="search" style="min-width:220px;">
          <span class="icon">üîé</span>
          <input id="search" placeholder="Szukaj produktu‚Ä¶" />
        </div>
      </div>
      <div class="muted" style="margin-top:6px;">
        Mini cennik: Szynka/Karczek/Schab/Boczek <b>47 z≈Ç/kg</b> ¬∑
        Kie≈Çbasa bia≈Ça <b>35 z≈Ç/kg</b> ¬∑ Kie≈Çbasa wƒôdzona <b>37 z≈Ç/kg</b> ¬∑
        Polƒôdwiczka <b>25 z≈Ç/szt</b> ¬∑ Pasztet <b>20 z≈Ç/szt</b> ¬∑ Salceson <b>35 z≈Ç/kg</b> ¬∑
        Serki (bez przypraw / czarnuszka / pomidory-bazylia / czosnek / curry / chilli) <b>10 z≈Ç/szt</b> ¬∑
        Makrela <b>22 z≈Ç/szt</b> ¬∑ ≈öled≈∫ <b>20 z≈Ç/szt</b> ¬∑ ≈Åoso≈õ <b>55 z≈Ç/kg</b> ¬∑ Krupniok <b>18 z≈Ç/kg</b>.
      </div>
      <div id="product-list" class="grid" style="gap:10px; margin-top:8px;"></div>
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-top:10px;">
        <span class="pill">Razem ilo≈õƒá: <b id="total-qty">0</b></span>
        <span class="pill">Razem kwota: <b id="total-sum">0,00 z≈Ç</b></span>
      </div>

      <!-- Przycisk dodaj w≈ÇasnƒÖ pozycjƒô przeniesiony na d√≥≈Ç -->
      <div id="custom-section">
        <button id="btn-add-custom-bottom">‚ûï Dodaj w≈ÇasnƒÖ pozycjƒô (do wyceny)</button>
      </div>
    </div>

    <div class="card">
      <h3>Wysy≈Çka</h3>
      <div class="grid-2">
        <input id="dest-phone" value="48791412017" placeholder="Numer do WhatsApp/SMS (np. 48600111222)" inputmode="tel" />
        <div></div>
      </div>
      <div class="muted" style="margin-top:6px;">Numer w formacie miƒôdzynarodowym, bez spacji.</div>
    </div>

    <div class="card">
      <h3>Podsumowanie</h3>
      <div class="summary" id="summary"></div>
    </div>
  </div>

  <!-- Modal: Dodaj w≈ÇasnƒÖ pozycjƒô (do wyceny) -->
  <div class="modal-backdrop" id="modal-custom">
    <div class="modal">
      <h4>Dodaj w≈ÇasnƒÖ pozycjƒô (do wyceny)</h4>
      <div class="grid">
        <div style="grid-column:1/-1">
          <label for="custom-name" class="field-note">Nazwa (wymagane, 3‚Äì60 znak√≥w)</label>
          <input id="custom-name" maxlength="60" placeholder="np. Szynka specjalna" />
        </div>
        <div>
          <label for="custom-qty" class="field-note">Ilo≈õƒá (wymagane, &gt; 0)</label>
          <input id="custom-qty" type="number" step="0.01" inputmode="decimal" placeholder="np. 1" />
        </div>
        <div>
          <label for="custom-unit" class="field-note">Jednostka</label>
          <select id="custom-unit">
            <option value="kg">kg</option>
            <option value="szt">szt</option>
          </select>
        </div>
        <div style="grid-column:1/-1">
          <label for="custom-notes" class="field-note">Uwagi (opcjonalnie)</label>
          <input id="custom-notes" placeholder="np. grubo mielone, lekko pikantne" />
        </div>
      </div>
      <div class="actions">
        <button class="btn ghost" id="custom-cancel">Anuluj</button>
        <button class="btn primary" id="custom-save">Dodaj pozycjƒô</button>
      </div>
    </div>
  </div>

  <div class="actions-bottom">
    <div class="actions-grid">
      <button class="btn" id="btn-copy">Kopiuj</button>
      <button class="btn" id="btn-csv">CSV</button>
      <a class="btn" id="btn-email" href="#">E-mail</a>
      <a class="btn primary" id="btn-wa" href="#" target="_blank">WhatsApp</a>
      <a class="btn" id="btn-sms" href="#">SMS</a>
      <button class="btn ghost" id="btn-clear">Wyczy≈õƒá</button>
    </div>
  </div>
</div>

<script>
// === KONFIGURACJA ===
const VAC_PRICE = 1.5; // z≈Ç za pozycjƒô z pakowaniem
const PRICES = {
  'Szynka wƒôdzona': { value: 47, unit: 'kg' },
  'Schab wƒôdzony': { value: 47, unit: 'kg' },
  'Boczek wƒôdzony': { value: 47, unit: 'kg' },
  'Karczek wƒôdzony': { value: 47, unit: 'kg' },
  'Kie≈Çbasa bia≈Ça parzona': { value: 35, unit: 'kg' },
  'Kie≈Çbasa wƒôdzona': { value: 37, unit: 'kg' },
  'Polƒôdwiczka wieprzowa': { value: 25, unit: 'szt' },
  'Pasztet': { value: 20, unit: 'szt' },
  'Salceson': { value: 35, unit: 'kg' },
  'Ser bez przypraw': { value: 10, unit: 'szt' },
  'Ser z czarnuszkƒÖ': { value: 10, unit: 'szt' },
  'Ser z pomidorami i bazyliƒÖ': { value: 10, unit: 'szt' },
  'Ser z czosnkiem': { value: 10, unit: 'szt' },
  'Ser z przyprawƒÖ curry': { value: 10, unit: 'szt' },
  'Ser z chilli': { value: 10, unit: 'szt' },
  'Makrela wƒôdzona': { value: 22, unit: 'szt' },
  '≈öled≈∫ wƒôdzony': { value: 20, unit: 'szt' },
  '≈Åoso≈õ wƒôdzony': { value: 55, unit: 'kg' },
  'Krupniok (kaszanka)': { value: 18, unit: 'kg' }
};

const BASE_PRODUCTS = Object.keys(PRICES).map((name) => {
  const p = PRICES[name];
  return { id: 'p-' + name.toLowerCase().replace(/[^a-z0-9]+/g,'-'), name, unit: p.unit, price: p.value, pack:false, qty: 0, notes:'' };
});

// === STAN I PAMIƒòƒÜ ===
let state = {
  rows: [], // {id, name, unit, price? (number), qty (number), pack (bool), notes (string)}
  filter: ''
};

function loadState(){
  try{
    const s = JSON.parse(localStorage.getItem('wd-state-v2')||'null');
    if(s && Array.isArray(s.rows)){
      state.rows = s.rows;
    } else {
      state.rows = [...BASE_PRODUCTS];
    }
  }catch(e){
    state.rows = [...BASE_PRODUCTS];
  }
}

function saveState(){
  localStorage.setItem('wd-state-v2', JSON.stringify({ rows: state.rows, filter: state.filter }));
}

function saveAndRender(){ saveState(); render(); }

// === RENDEROWANIE ===
const listEl = document.getElementById('product-list');
const totalQtyEl = document.getElementById('total-qty');
const totalSumEl = document.getElementById('total-sum');
const summaryEl = document.getElementById('summary');

function formatPrice(v){ return (v||0).toFixed(2).replace('.', ',') + ' z≈Ç'; }
function parseQty(val){ return Math.max(0, parseFloat((''+val).replace(',', '.')) || 0); }

function makeRowEl(row){
  const wrap = document.createElement('div');
  wrap.className = 'row product';

  const hasKnownPrice = typeof row.price === 'number' && row.price > 0;

  // kolumna nazwa + cena
  const col1 = document.createElement('div');
  col1.className = 'name';
  const left = document.createElement('div');
  const title = document.createElement('strong');
  title.textContent = row.name;
  left.appendChild(title);

  if(!hasKnownPrice){
    const badge = document.createElement('span');
    badge.className = 'badge';
    badge.innerHTML = '<span class="dot"></span> DO WYCENY';
    left.appendChild(document.createTextNode(' '));
    left.appendChild(badge);
  }

  const right = document.createElement('div');
  right.className = 'price';
  right.textContent = hasKnownPrice ? (row.price + ' z≈Ç/' + row.unit) : '‚Äî';

  col1.appendChild(left);
  col1.appendChild(right);

  // kolumna ilo≈õƒá
  const col2 = document.createElement('div');
  const qtyInput = document.createElement('input');
  qtyInput.type = 'number';
  qtyInput.step = '0.01';
  qtyInput.placeholder = row.unit === 'kg' ? 'kg' : 'szt';
  qtyInput.value = row.qty > 0 ? row.qty : '';
  qtyInput.addEventListener('input', () => {
    row.qty = parseQty(qtyInput.value);
    saveAndRender();
  });
  col2.appendChild(qtyInput);

  // kolumna pakowanie
  const col3 = document.createElement('div');
  const packLabel = document.createElement('label');
  packLabel.style.display = 'inline-flex';
  packLabel.style.alignItems = 'center';
  packLabel.style.gap = '8px';
  const packInput = document.createElement('input');
  packInput.type = 'checkbox';
  packInput.checked = !!row.pack;
  packInput.addEventListener('change', () => {
    row.pack = packInput.checked;
    saveAndRender();
  });
  packLabel.appendChild(packInput);
  const packSpan = document.createElement('span');
  packSpan.textContent = 'Pakowanie pr√≥≈ºniowe (+1,50 z≈Ç)';
  packLabel.appendChild(packSpan);
  col3.appendChild(packLabel);

  // kolumna uwagi
  const col4 = document.createElement('div');
  const notesInput = document.createElement('input');
  notesInput.placeholder = 'Uwagi (opcjonalnie)';
  notesInput.value = row.notes || '';
  notesInput.addEventListener('input', () => { row.notes = notesInput.value; saveState(); }); // nie renderuj co znak
  col4.appendChild(notesInput);

  wrap.appendChild(col1);
  wrap.appendChild(col2);
  wrap.appendChild(col3);
  wrap.appendChild(col4);
  return wrap;
}

function render(){
  // filtr
  const q = (state.filter||'').trim().toLowerCase();
  const rows = state.rows.filter(r => !q || r.name.toLowerCase().includes(q));

  // lista
  listEl.innerHTML = '';
  rows.forEach(r => listEl.appendChild(makeRowEl(r)));

  // sumy
  let totalQty = 0;
  let total = 0;
  let vacCount = 0;

  const ordered = state.rows.filter(r => r.qty > 0);
  ordered.forEach(r => {
    totalQty += r.qty;
    if(typeof r.price === 'number' && r.price > 0){
      total += r.qty * r.price;
    }
    if(r.pack) vacCount += 1;
  });
  const vacCost = vacCount * VAC_PRICE;
  const grand = total + vacCost;

  totalQtyEl.textContent = (Math.round(totalQty*100)/100).toString().replace('.', ',');
  totalSumEl.textContent = formatPrice(grand);

  // podsumowanie
  const lines = [];
  const custName = (document.getElementById('cust-name').value||'').trim();
  const custPhone = (document.getElementById('cust-phone').value||'').trim();
  const custEmail = (document.getElementById('cust-email').value||'').trim();
  const custDate = (document.getElementById('cust-date').value||'').trim();
  const custNotes = (document.getElementById('cust-notes').value||'').trim();

  if(custName) lines.push('Klient: ' + custName);
  if(custPhone) lines.push('Telefon: ' + custPhone);
  if(custEmail) lines.push('E-mail: ' + custEmail);
  if(custDate) lines.push('Data odbioru: ' + custDate);
  if(custNotes) lines.push('Uwagi: ' + custNotes);
  if(lines.length) lines.push('');

  lines.push('Zam√≥wienie:');
  if(ordered.length === 0){
    lines.push('‚Äî (brak pozycji)');
  } else {
    ordered.forEach(r => {
      const base = `${r.name}: ${r.qty} ${r.unit}`;
      const priceInfo = (typeof r.price === 'number' && r.price > 0) ? ` @ ${r.price} z≈Ç/${r.unit}` : ' (do wyceny)';
      const bits = [base + priceInfo];
      if(r.pack) bits.push('[pakowanie +1,50 z≈Ç]');
      if(r.notes) bits.push(`[uwagi: ${r.notes}]`);
      lines.push('‚Ä¢ ' + bits.join(' '));
    });
  }
  lines.push('');

  lines.push(`Suma produkt√≥w: ${formatPrice(total)}`);
  lines.push(`Pakowanie: ${vacCount} √ó ${formatPrice(VAC_PRICE)} = ${formatPrice(vacCost)}`);
  lines.push(`RAZEM: ${formatPrice(grand)}`);

  summaryEl.textContent = lines.join('\n');
}

// === WYSZUKIWARKA ===
document.getElementById('search').addEventListener('input', (e)=>{
  state.filter = e.target.value;
  saveAndRender();
});

// === PAKOWANIE ZBIORCZE ===
document.getElementById('btn-pack-all').addEventListener('click', ()=>{
  state.rows.forEach(r => { if(r.qty > 0) r.pack = true; });
  saveAndRender();
});
document.getElementById('btn-pack-clear').addEventListener('click', ()=>{
  state.rows.forEach(r => { r.pack = false; });
  saveAndRender();
});

// === AKCJE EKSPORTU ===
function getSummaryText(){ return document.getElementById('summary').textContent; }

document.getElementById('btn-copy').addEventListener('click', async ()=>{
  try{
    await navigator.clipboard.writeText(getSummaryText());
    alert('Skopiowano podsumowanie do schowka.');
  }catch(e){
    alert('Nie uda≈Ço siƒô skopiowaƒá. Skopiuj rƒôcznie z sekcji Podsumowanie.');
  }
});

document.getElementById('btn-csv').addEventListener('click', ()=>{
  const rows = [['Nazwa','Ilo≈õƒá','Jednostka','Cena jednostkowa','Pakowanie','Uwagi']];
  state.rows.filter(r => r.qty > 0).forEach(r => {
    rows.push([
      r.name,
      String(r.qty).replace('.',','),
      r.unit,
      (typeof r.price === 'number' && r.price > 0) ? (String(r.price).replace('.',',')+' z≈Ç/'+r.unit) : 'do wyceny',
      r.pack ? 'tak' : 'nie',
      r.notes || ''
    ]);
  });
  const csv = rows.map(r => r.map(v => '"'+String(v).replaceAll('"','""')+'"').join(';')).join('\r\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'zamowienie.csv';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
});

function encodeText(t){ return encodeURIComponent(t).replace(/%20/g,'+'); }
function prepMessage(){ return getSummaryText(); }

document.getElementById('btn-email').addEventListener('click', (e)=>{
  const subject = 'Zam√≥wienie ‚Äî Wƒôdliny z Druciarni';
  const body = prepMessage();
  e.currentTarget.href = 'mailto:?subject=' + encodeText(subject) + '&body=' + encodeText(body);
});

document.getElementById('btn-wa').addEventListener('click', (e)=>{
  const num = (document.getElementById('dest-phone').value||'').replace(/\D+/g,'');
  const text = prepMessage();
  e.currentTarget.href = 'https://wa.me/' + num + '?text=' + encodeText(text);
});

document.getElementById('btn-sms').addEventListener('click', (e)=>{
  const num = (document.getElementById('dest-phone').value||'').replace(/\D+/g,'');
  const text = prepMessage();
  e.currentTarget.href = 'sms:' + num + '?&body=' + encodeText(text);
});

document.getElementById('btn-clear').addEventListener('click', ()=>{
  if(!confirm('Na pewno wyczy≈õciƒá formularz?')) return;
  localStorage.removeItem('wd-state-v2');
  state.rows = [...BASE_PRODUCTS];
  document.getElementById('cust-name').value = '';
  document.getElementById('cust-phone').value = '';
  document.getElementById('cust-email').value = '';
  document.getElementById('cust-date').value = '';
  document.getElementById('cust-notes').value = '';
  render();
});

// === MODAL W≈ÅASNA POZYCJA ===
function openCustomModal(){ modal.open(); }
const modal = {
  el: document.getElementById('modal-custom'),
  name: null, qty: null, unit: null, notes: null,
  open(){
    this.name = document.getElementById('custom-name');
    this.qty = document.getElementById('custom-qty');
    this.unit = document.getElementById('custom-unit');
    this.notes = document.getElementById('custom-notes');
    this.name.value = '';
    this.qty.value = '';
    this.unit.value = 'kg';
    this.notes.value = '';
    this.clearErrors();
    this.el.style.display = 'flex';
    setTimeout(()=> this.name.focus(), 0);
  },
  close(){ this.el.style.display = 'none'; },
  clearErrors(){
    [this.name,this.qty].forEach(i=> i && i.classList.remove('error'));
  },
  validate(){
    this.clearErrors();
    const n = (this.name.value||'').trim();
    const q = parseFloat((this.qty.value||'').replace(',', '.'));
    let ok = true;
    if (n.length < 3 || n.length > 60){ this.name.classList.add('error'); ok = false; }
    if (!(q > 0)){ this.qty.classList.add('error'); ok = false; }
    return ok ? { name:n, qty:q, unit:this.unit.value, notes:(this.notes.value||'').trim() } : null;
  }
};
function closeCustomModal(){ modal.close(); }
document.getElementById('custom-cancel').addEventListener('click', closeCustomModal);
document.getElementById('modal-custom').addEventListener('click', (e)=>{
  if (e.target === document.getElementById('modal-custom')) closeCustomModal();
});
document.getElementById('custom-save').addEventListener('click', ()=>{
  const data = modal.validate();
  if (!data) return;
  const id = 'custom-' + Date.now().toString(36);
  // pozycja w≈Çasna ‚Äî bez znanej ceny (do wyceny)
  state.rows.push({ id, name: data.name, qty: data.qty, unit: data.unit, price: undefined, pack:false, notes:data.notes });
  saveAndRender();
  closeCustomModal();
});
// Nowy przycisk na dole
const btnBottom = document.getElementById('btn-add-custom-bottom');
btnBottom.addEventListener('click', openCustomModal);

// Zainicjalizuj
loadState();
render();

// Aktualizuj podsumowanie przy zmianach danych klienta
['cust-name','cust-phone','cust-email','cust-date','cust-notes'].forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener('input', ()=> { saveState(); render(); });
});
</script>
</body>
</html>
