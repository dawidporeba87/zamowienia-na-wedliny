<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Wƒôdliny z Druciarni ‚Äî Zam√≥wienia</title>
<meta name="theme-color" content="#111827">
<style>
  :root{ --bg:#0b0f1a; --card:#111827; --muted:#9ca3af; --text:#e5e7eb; --accent:#fbbf24; --btn:#1f2937; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
  .app{display:flex;flex-direction:column;min-height:100dvh}
  .topbar{position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:12px;padding:12px 16px;background:rgba(17,24,39,.9);backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid #1f2937}
  .logo{height:56px;width:auto;border-radius:12px;background:#0b0f1a;padding:6px}
  .title{display:flex;flex-direction:column;line-height:1.1}
  .title h1{margin:0;font-size:18px}
  .title .tag{font-size:12px;color:var(--muted)}
  .content{flex:1;padding:16px;display:grid;gap:14px}
  .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:14px;box-shadow:0 2px 10px rgba(0,0,0,.2)}
  h3{margin:0 0 8px 0;font-size:16px}
  input,select,textarea,button{font:inherit}
  input,select,textarea{width:100%;padding:14px;border-radius:12px;border:1px solid #293445;background:#0b1220;color:var(--text)}
  textarea{min-height:96px}
  .grid-2{display:grid;gap:10px;grid-template-columns:1fr}
  @media (min-width:760px){.grid-2{grid-template-columns:1fr 1fr}}
  .row{display:grid;gap:10px;grid-template-columns:1fr}
  @media (min-width:520px){.row{grid-template-columns:5fr 5fr 3fr;align-items:center}}
  .qty{display:grid;grid-template-columns:auto 1fr auto;gap:8px}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:14px 16px;border-radius:14px;border:1px solid #2a3648;background:var(--btn);color:var(--text);text-decoration:none;cursor:pointer;min-height:48px}
  .btn.primary{background:linear-gradient(180deg,#f59e0b,#f59e0b 60%,#d97706);color:#111;border-color:#f59e0b}
  .btn.ghost{background:transparent}
  .btn.small{padding:8px 10px;min-height:36px;font-size:12px;border-radius:10px}
  .actions-bottom{position:sticky;bottom:0;z-index:10;background:rgba(17,24,39,.96);backdrop-filter:blur(8px);border-top:1px solid #1f2937;padding:10px 12px}
  .actions-grid{display:grid;gap:8px;grid-template-columns:1fr 1fr}
  @media (min-width:560px){.actions-grid{grid-template-columns:repeat(6,1fr)}}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#0b1220;border:1px solid #2a3648;color:var(--muted);font-size:12px}
  .muted{color:var(--muted);font-size:12px}
  .summary{background:#0b1220;border:1px solid #2a3648;border-radius:12px;padding:12px;white-space:pre-wrap}
  .search input{padding-left:44px}
  .search{position:relative}
  .search .icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);opacity:.6}
  .product{display:grid;gap:10px}
  .product .name{display:flex;align-items:center;gap:10px;justify-content:space-between}
  .product .name strong{font-size:14px}
  .price{font-size:12px;color:var(--muted)}
  .pack{display:flex;align-items:center;gap:8px;font-size:12px;color:#cfe5d9}
  .pack-controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}

/* === Custom tweaks requested === */
/* Bigger checkbox and tighter spacing for vacuum packing option */
.pack { gap: 6px; }
.pack input[type="checkbox"] {
  transform: scale(1.35);
}

/* Make prices a bit larger and bold, without going overboard */
.price {
  font-size: 14px;
  font-weight: 700;
  color: #e5e7eb; /* slightly brighter than muted for better emphasis */
}

</style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <img src="logo.png" class="logo" alt="Logo" />
    <div class="title">
      <h1>Wƒôdliny z Druciarni</h1>
      <div class="tag">Formularz zam√≥wie≈Ñ</div>
    </div>
  </div>

  <div class="content">
    <div class="card">
      <h3>Klient</h3>
      <div class="grid-2">
        <input id="cust-name" placeholder="Imiƒô i nazwisko" />
        <input id="cust-phone" placeholder="Telefon" inputmode="tel" />
        <input id="cust-email" placeholder="E-mail (opcjonalnie)" inputmode="email" />
        <input id="cust-date" type="date" placeholder="Data odbioru" />
        <textarea id="cust-notes" placeholder="Uwagi do zam√≥wienia (np. grubo≈õƒá, przyprawy)"></textarea>
      </div>
      <div class="muted" style="margin-top:6px;">
        Pakowanie pr√≥≈ºniowe mo≈ºliwe za dop≈ÇatƒÖ: <strong>1,50 z≈Ç</strong> za ka≈ºdƒÖ pozycjƒô z zaznaczeniem opcji.
        <div class="pack-controls">
          <button class="btn small" id="btn-pack-all">Zaznacz pakowanie dla wszystkich z ilo≈õciƒÖ</button>
          <button class="btn small ghost" id="btn-pack-clear">Odznacz pakowanie wszƒôdzie</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
        <h3>Produkty</h3>
        <div class="search" style="min-width:220px;">
          <span class="icon">üîé</span>
          <input id="search" placeholder="Szukaj produktu‚Ä¶" />
        </div>
      </div>
      <div class="muted" style="margin-top:6px;">
        Mini cennik: Szynka/Karczek/Schab/Boczek <b>47 z≈Ç/kg</b> ¬∑
        Kie≈Çbasa bia≈Ça <b>35 z≈Ç/kg</b> ¬∑ Kie≈Çbasa wƒôdzona <b>37 z≈Ç/kg</b> ¬∑
        Polƒôdwiczka <b>25 z≈Ç/szt</b> ¬∑ Pasztet <b>20 z≈Ç/szt</b> ¬∑ Salceson <b>35 z≈Ç/kg</b> ¬∑
        Serki (bez przypraw / czarnuszka / pomidory-bazylia / czosnek / curry / chilli) <b>10 z≈Ç/szt</b> ¬∑
        Makrela <b>22 z≈Ç/szt</b> ¬∑ ≈öled≈∫ <b>20 z≈Ç/szt</b> ¬∑ ≈Åoso≈õ <b>55 z≈Ç/kg</b> ¬∑ Krupniok <b>18 z≈Ç/kg</b>.
      </div>
      <div id="product-list" class="grid" style="gap:10px; margin-top:8px;"></div>
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-top:10px;">
        <span class="pill">Razem ilo≈õƒá: <b id="total-qty">0</b></span>
        <span class="pill">Razem kwota: <b id="total-sum">0,00 z≈Ç</b></span>
        <button class="btn" id="btn-add">+ Dodaj pozycjƒô</button>
      </div>
    </div>

    <div class="card">
      <h3>Wysy≈Çka</h3>
      <div class="grid-2">
        <input id="dest-phone" value="48791412017" placeholder="Numer do WhatsApp/SMS (np. 48600111222)" inputmode="tel" />
        <div></div>
      </div>
      <div class="muted" style="margin-top:6px;">Numer w formacie miƒôdzynarodowym, bez spacji.</div>
    </div>

    <div class="card">
      <h3>Podsumowanie</h3>
      <div class="summary" id="summary"></div>
    </div>
  </div>

  <div class="actions-bottom">
    <div class="actions-grid">
      <button class="btn" id="btn-copy">Kopiuj</button>
      <button class="btn" id="btn-csv">CSV</button>
      <a class="btn" id="btn-email" href="#">E‚Äëmail</a>
      <a class="btn primary" id="btn-wa" href="#" target="_blank">WhatsApp</a>
      <a class="btn" id="btn-sms" href="#">SMS</a>
      <button class="btn ghost" id="btn-clear">Wyczy≈õƒá</button>
    </div>
  </div>
</div>

<script>
// === KONFIG: cennik ===
const PRICE_LIST = [
  { name: "Szynka wƒôdzona", unit: "kg", price: 47.00 },
  { name: "Karczek wƒôdzony", unit: "kg", price: 47.00 },
  { name: "Schab wƒôdzony", unit: "kg", price: 47.00 },
  { name: "Boczek wƒôdzony", unit: "kg", price: 47.00 },

  { name: "Polƒôdwiczka wieprzowa", unit: "szt", price: 25.00 },

  { name: "Kie≈Çbasa bia≈Ça parzona", unit: "kg", price: 35.00 },
  { name: "Kie≈Çbasa wƒôdzona", unit: "kg", price: 37.00 },

  { name: "Pasztet", unit: "szt", price: 20.00 },
  { name: "Salceson", unit: "kg", price: 35.00 },

  { name: "Ser bez przypraw", unit: "szt", price: 10.00 },
  { name: "Ser z czarnuszkƒÖ", unit: "szt", price: 10.00 },
  { name: "Ser z pomidorami i bazyliƒÖ", unit: "szt", price: 10.00 },
  { name: "Ser z czosnkiem", unit: "szt", price: 10.00 },
  { name: "Ser z przyprawƒÖ curry", unit: "szt", price: 10.00 },
  { name: "Ser z chilli", unit: "szt", price: 10.00 },

  { name: "Ryby wƒôdzone ‚Äî makrela", unit: "szt", price: 22.00 },
  { name: "Ryby wƒôdzone ‚Äî ≈õled≈∫", unit: "szt", price: 20.00 },
  { name: "Ryby wƒôdzone ‚Äî ≈Çoso≈õ", unit: "kg", price: 55.00 },

  { name: "Krupniok (kaszanka)", unit: "kg", price: 18.00 },
  { name: "Indyk (szt.)", unit: "szt", price: 25.00 }
];
const VAC_PRICE = 1.50; // dop≈Çata za pakowanie pr√≥≈ºniowe (za pozycjƒô)
const PLN = new Intl.NumberFormat('pl-PL', { style:'currency', currency:'PLN' });

const PRICE_MAP = Object.fromEntries(PRICE_LIST.map(p => [p.name, {unit:p.unit, price:p.price}]));
const DEFAULT_ROWS = PRICE_LIST.map(p => ({ id: slug(p.name), name: p.name, qty: 0, unit: p.unit, pack: false }));

const state = { rows: [], customer: { name:'', phone:'', email:'', pickupDate:'', notes:'' } };

const els = {
  list: document.getElementById('product-list'),
  search: document.getElementById('search'),
  totalQty: document.getElementById('total-qty'),
  totalSum: document.getElementById('total-sum'),
  summary: document.getElementById('summary'),
  destPhone: document.getElementById('dest-phone'),
};

function loadDraft() { try {
  const raw = localStorage.getItem('zamowienia-wedliny-app-draft');
  if (!raw) return;
  const data = JSON.parse(raw);
  if (Array.isArray(data.rows)) state.rows = data.rows.map(r => ({ pack:false, ...r }));
  if (data.customer) state.customer = data.customer;
} catch(e){} }

function saveDraft() { localStorage.setItem('zamowienia-wedliny-app-draft', JSON.stringify(state)); }

function initRows() { if (!state.rows.length) { state.rows = DEFAULT_ROWS.slice(); } }
function slug(s) { return s.toLowerCase().replace(/[^a-z0-9ƒÖƒáƒô≈Ç≈Ñ√≥≈õ≈∫≈º]+/g,'-').replace(/(^-|-$)/g,''); }

function rowPrice(r){ const meta = PRICE_MAP[r.name]; return meta ? meta.price : 0; }
function rowUnit(r){ const meta = PRICE_MAP[r.name]; return meta ? meta.unit : r.unit; }

function render() {
  // Inputs -> state
  state.customer.name = document.getElementById('cust-name').value;
  state.customer.phone = document.getElementById('cust-phone').value;
  state.customer.email = document.getElementById('cust-email').value;
  state.customer.pickupDate = document.getElementById('cust-date').value;
  state.customer.notes = document.getElementById('cust-notes').value;

  // Filter
  const q = (els.search.value || '').trim().toLowerCase();
  const filtered = state.rows.filter(r => r.name.toLowerCase().includes(q));

  // List
  els.list.innerHTML = '';
  filtered.forEach(r => {
    const card = document.createElement('div');
    card.className = 'product card';

    // Nag≈Ç√≥wek z nazwƒÖ + cena
    const nameWrap = document.createElement('div');
    nameWrap.className = 'name';
    const name = document.createElement('input');
    name.value = r.name;
    name.oninput = () => { r.name = name.value; saveAndRender(); };
    const priceInfo = document.createElement('span');
    const p = rowPrice(r); const u = rowUnit(r);
    priceInfo.className = 'price';
    priceInfo.textContent = p ? `${PLN.format(p)} / ${u}` : '‚Äî brak ceny (pozycja w≈Çasna)';
    nameWrap.appendChild(name);
    nameWrap.appendChild(priceInfo);

    // Ilo≈õƒá + jednostka
    const qty = document.createElement('div');
    qty.className = 'qty';
    const minus = document.createElement('button'); minus.className = 'btn'; minus.textContent = '‚àí';
    minus.onclick = () => { r.qty = Math.max(0, (Number(r.qty)||0) - 1); saveAndRender(); };
    const qtyInput = document.createElement('input');
    qtyInput.type='number'; qtyInput.inputMode='decimal'; qtyInput.min='0'; qtyInput.step='0.1';
    qtyInput.value = r.qty; qtyInput.oninput = () => { r.qty = qtyInput.value; saveAndRender(); };
    const unit = document.createElement('select');
    unit.innerHTML = '<option value="kg">kg</option><option value="szt">szt</option>';
    unit.value = r.unit; unit.onchange = () => { r.unit = unit.value; saveAndRender(); };
    const plus = document.createElement('button'); plus.className='btn'; plus.textContent = '+';
    plus.onclick = () => { r.qty = (Number(r.qty)||0) + 1; saveAndRender(); };
    qty.appendChild(minus); qty.appendChild(qtyInput); qty.appendChild(unit); qty.appendChild(plus);

    // Pakowanie pr√≥≈ºniowe
    const pack = document.createElement('label');
    pack.className = 'pack';
    const packChk = document.createElement('input'); packChk.type='checkbox'; packChk.checked = !!r.pack;
    packChk.onchange = () => { r.pack = packChk.checked; saveAndRender(); };
    const packTxt = document.createElement('span'); packTxt.textContent = `Pakowanie pr√≥≈ºniowe (+${PLN.format(VAC_PRICE)})`;
    pack.appendChild(packChk); pack.appendChild(packTxt);

    // Usu≈Ñ (dla pozycji w≈Çasnych)
    const actions = document.createElement('div');
    const del = document.createElement('button'); del.className='btn ghost'; del.textContent='Usu≈Ñ';
    del.onclick = () => { state.rows = state.rows.filter(x => x !== r); saveAndRender(); };
    if (r.id.startsWith('custom-')) actions.appendChild(del);

    card.appendChild(nameWrap);
    card.appendChild(qty);
    card.appendChild(pack);
    if (r.id.startsWith('custom-')) card.appendChild(actions);

    els.list.appendChild(card);
  });

  // Totals & summary
  const totalQty = state.rows.reduce((s,r)=> s + (Number(r.qty)||0), 0);
  const itemsTotal = state.rows.reduce((s,r)=> {
    const q = Number(r.qty)||0; const price = rowPrice(r); const u = rowUnit(r);
    if (!price || q<=0) return s; // brak ceny = nie liczymy warto≈õci
    return s + (price * q);
  }, 0);
  const packCount = state.rows.filter(r => (Number(r.qty)||0) > 0 && r.pack).length;
  const packTotal = packCount * VAC_PRICE;
  const grand = itemsTotal + packTotal;

  els.totalQty.textContent = totalQty;
  els.totalSum.textContent = PLN.format(grand);
  els.summary.textContent = buildSummary(itemsTotal, packCount, packTotal, grand);

  saveDraft();
}

function saveAndRender(){ saveDraft(); render(); }

function buildSummary(itemsTotal, packCount, packTotal, grand) {
  const lines = [];
  lines.push('Zam√≥wienie na wyroby domowe ‚Äî Wƒôdliny z Druciarni');
  lines.push(`Klient: ${state.customer.name || '(brak)'}`);
  lines.push(`Telefon: ${state.customer.phone || '(brak)'}`);
  if (state.customer.email) lines.push(`Email: ${state.customer.email}`);
  if (state.customer.pickupDate) lines.push(`Odbi√≥r: ${state.customer.pickupDate}`);
  if (state.customer.notes) lines.push(`Uwagi: ${state.customer.notes}`);
  lines.push('');
  lines.push('Pozycje:');
  state.rows.forEach(r => {
    const q = Number(r.qty)||0; if (q<=0) return;
    const price = rowPrice(r); const u = rowUnit(r);
    const line = price ? `‚Ä¢ ${r.name} ‚Äî ${q} ${r.unit} √ó ${PLN.format(price)} = ${PLN.format(price*q)}` : `‚Ä¢ ${r.name} ‚Äî ${q} ${r.unit}`;
    lines.push(line + (r.pack ? ` [pakowanie +${PLN.format(VAC_PRICE)}]` : ''));
  });
  lines.push('');
  lines.push(`Warto≈õƒá produkt√≥w: ${PLN.format(itemsTotal)}`);
  lines.push(`Dop≈Çata za pakowanie: ${packCount} √ó ${PLN.format(VAC_PRICE)} = ${PLN.format(packTotal)}`);
  lines.push(`Razem do zap≈Çaty: ${PLN.format(grand)}`);
  lines.push('‚Äî wys≈Çano z formularza zam√≥wie≈Ñ');
  return lines.join('\n');
}

function toEmailHref(){
  const subject = encodeURIComponent('Zam√≥wienie ‚Äî Wƒôdliny z Druciarni');
  const body = encodeURIComponent(els.summary.textContent);
  const addr = 'dawidporeba87@gmail.com';
  return `mailto:${addr}?subject=${subject}&body=${body}`;
}
function normPhone(s){ return (s||'').replace(/\s+/g,'').replace(/^\+/, ''); }
function toWhatsAppHref(){ const phone = normPhone(els.destPhone.value); const text = encodeURIComponent(els.summary.textContent); return phone ? `https://wa.me/${phone}?text=${text}` : `https://wa.me/?text=${text}`; }
function toSMSHref(){ const phone = normPhone(els.destPhone.value); const text = encodeURIComponent(els.summary.textContent); return `sms:${phone}?&body=${text}`; }

function exportCSV() {
  const header = ['Produkt','Ilo≈õƒá','Jednostka','Cena_jednostkowa_PLN','Pakowanie_prozniowe','Suma_pozycji_PLN','Klient','Telefon','Email','Data_odbioru','Uwagi'];
  const lines = [header.join(',')];
  state.rows.forEach(r => {
    const q = Number(r.qty)||0; if (q<=0) return;
    const price = rowPrice(r); const u = rowUnit(r);
    const lineSum = price ? (price*q + (r.pack?VAC_PRICE:0)) : '';
    lines.push([
      r.name,
      q,
      r.unit,
      price || '',
      r.pack ? 'TAK' : 'NIE',
      lineSum || '',
      state.customer.name,
      state.customer.phone,
      state.customer.email,
      state.customer.pickupDate,
      (state.customer.notes||'').replaceAll(',', ';')
    ].join(','));
  });
  const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob); const a = document.createElement('a');
  a.href = url; a.download = `zamowienie_${new Date().toISOString().slice(0,10)}.csv`; a.click(); URL.revokeObjectURL(url);
}

// Actions
document.getElementById('btn-add').onclick = () => { state.rows.push({ id:'custom-'+Date.now(), name:'Pozycja w≈Çasna', qty:0, unit:'kg', pack:false }); saveAndRender(); };

document.getElementById('btn-clear').onclick = () => {
  if(!confirm('Wyczy≈õciƒá wszystkie ilo≈õci i dane klienta?')) return;
  state.rows.forEach(r=> { r.qty=0; r.pack=false; });
  state.customer={ name:'', phone:'', email:'', pickupDate:'', notes:'' };
  document.getElementById('cust-name').value='';
  document.getElementById('cust-phone').value='';
  document.getElementById('cust-email').value='';
  document.getElementById('cust-date').value='';
  document.getElementById('cust-notes').value='';
  saveAndRender();
};

document.getElementById('btn-copy').onclick = async () => { await navigator.clipboard.writeText(els.summary.textContent); alert('Podsumowanie skopiowane.'); };
document.getElementById('btn-csv').onclick = exportCSV;
document.getElementById('btn-email').onclick = (e) => { e.currentTarget.href = toEmailHref(); };
document.getElementById('btn-wa').onclick = (e) => { e.currentTarget.href = toWhatsAppHref(); };
document.getElementById('btn-sms').onclick = (e) => { e.currentTarget.href = toSMSHref(); };

// Nowe: zbiorcze ustawianie pakowania pr√≥≈ºniowego
document.getElementById('btn-pack-all').onclick = () => {
  state.rows.forEach(r => { if ((Number(r.qty)||0) > 0) r.pack = true; });
  saveAndRender();
};
document.getElementById('btn-pack-clear').onclick = () => {
  state.rows.forEach(r => { r.pack = false; });
  saveAndRender();
};

// Inputs binding
['cust-name','cust-phone','cust-email','cust-date','cust-notes','search'].forEach(id => { document.getElementById(id).addEventListener('input', render); });

// Bootstrap
loadDraft(); initRows();
document.getElementById('cust-name').value = state.customer.name || '';
document.getElementById('cust-phone').value = state.customer.phone || '';
document.getElementById('cust-email').value = state.customer.email || '';
document.getElementById('cust-date').value = state.customer.pickupDate || '';
document.getElementById('cust-notes').value = state.customer.notes || '';
render();
</script>
</body>
</html>
